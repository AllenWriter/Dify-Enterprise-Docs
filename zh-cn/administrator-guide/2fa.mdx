---
title: 两步身份验证
---

<Info>
    两步身份验证机制面向企业后台，版本号需 ≥v2.4.0。
</Info>

## 介绍

企业后台包含着大量用户敏感信息，常规的账号密码无法满足企业对于信息安全的更高要求。具备访问权限的系统管理员需要更加高级的安全保障。

两步身份验证（Two-Factor Authentication，简称 2FA）是一种额外的安全认证机制，要求用户在通过基础的验证后（例如输入邮箱和密码、通过 SSO 校验等），二次输入 TOTP App（基于时间的一次性密码应用程序）内实时更新的密钥以完成登录。

> 本文将统一使用 2FA 指代两步身份验证。

启用 2FA 功能后，即使原始的密码意外泄露，仍能避免未经授权的访问操作，确保系统管理员账户和企业后台的数据安全。

## 前置准备

- 系统管理员访问权限
- TOTP App，基于时间的一次性密码应用程序

TOTP App 会自动生成一个在单位时间内有效，实时更新的身份验证代码。在互联网中按照偏好自由搜索并下载任何 TOTP 应用程序（例如 [Google Authenticator](https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2)）。

## 开启 2FA

开启团队内全局 2FA 前，需确保已开启个人 2FA。

### 1. 开启个人账号的两步验证

访问企业版管理后台，轻点 "两步验证"，点击身份验证器右侧的 "配置" 按钮。按照提示，使用 TOTP App 扫描二维码，并输入 App 内提供的六位数字。

若不具备扫码条件，请将鼠标移至 Setup Key 获取密钥。将其输入至 TOTP App 内并生成六位数字。将六位数字填写至企业后台以完成两步验证配置。

![](https://assets-docs.dify.ai/2025/04/fd6b474384081f4079aa453c45c07562.png)

启用两步验证后，将同步生成备用码。为避免装有 TOTP App 的设备丢失而造成无法获取在线密钥，建议手抄或打印备用码至安全的地方。

![](https://assets-docs.dify.ai/2025/04/2c88c1492bf9a079df9ad4a25e1923ac.png)

备用码的效力为一次性。使用备用码登录后，被用码将会失效。如有更多需求，你可以点击备用码中的"重新生成"。

![](https://assets-docs.dify.ai/2025/04/8313cf497c66cfef7dee2a4ae816c32b.png)

### 2. 全局开启强制 2FA

> 所有系统管理员均具备开启团队全局两步验证的权限。

系统管理员为个人账号开启 2FA 后，可前往 **设置** → **身份认证** 开启全局两步身份验证。开启后，每位系统管理员登录企业版管理后台时，将被要求提供二步验证码。

![](https://assets-docs.dify.ai/2025/04/1271b3b0e39558465dbb79b17d1a9721.png)

## 修改 2FA

访问企业版管理后台，轻点 "两步验证"，点击身份验证器右侧菜单选项中的 "编辑" 按钮。使用 TOTP App 获取新的六位数字并填写至页面内即可完成替换。

## 关闭 2FA

<Warning>
关闭 2FA 验证可能会增加企业后台安全风险，建议谨慎关闭。
</Warning>

### 1. 关闭个人账号的两步验证

> 若企业后台已开启全局强制两步验证，则无法关闭个人账号的两步验证。

访问企业版管理后台，轻点 "两步验证"，点击右上角的关闭两步验证按钮。

### 2. 关闭全局强制 2FA

系统管理员前往**设置** → **身份认证**关闭 2FA。

## 常见问题

### 我忘记了带有 TOTP 应用的设备，如何登录？

如果您忘记或丢失了设备，可以使用以下方法进行登录：

1. **使用备用码登录**：登录页面上选择"使用备用码"选项，输入之前保存的备用码。请记住，每个备用码只能使用一次。
2. **联系其他系统管理员**：如果您没有备用码，请联系团队中的其他系统管理员获取帮助。

### TOTP 验证码输入正确但系统提示错误，如何解决？

验证码错误通常有以下原因：

1. **时间不同步**：TOTP 基于时间生成验证码，确保您的设备时间与标准时间同步。大多数智能手机会自动同步时间，但如果您关闭了自动同步，请在设备设置中开启。
2. **验证码过期**：TOTP 验证码通常每 30 秒更新一次。如果您在验证码即将过期时输入，可能会失效。请等待新的验证码生成后再尝试。
3. **设备与账号不匹配**：确认您正在使用正确的 TOTP 应用和正确的账号生成验证码。

### 更换手机后如何迁移 2FA 验证器？

有两种方法可以迁移 2FA 验证器：

1. **使用应用内迁移功能**：部分 TOTP 应用（如 Google Authenticator 最新版本）提供账号导出/导入功能，可以通过此功能将验证器信息迁移到新设备。
2. **重新设置 2FA**：
   - 使用备用码登录系统
   - 参考[修改 2FA](#修改-2fa)， 前往个人 2FA 设置页面，点击"编辑"
   - 使用新设备生成的验证码完成验证

### 全局强制启用 2FA 后，为启用 2FA 的新管理员如何登录？

当全局强制启用 2FA 后，新管理员首次登录的流程为：

1. 新管理员使用邮箱和密码（或 SSO）登录系统
2. 系统会自动检测到该管理员未配置 2FA，并引导其设置 2FA
3. 管理员需下载 TOTP 应用，并完成 2FA 设置
4. 设置完成后，系统将允许管理员继续登录

该流程确保所有管理员都必须使用 2FA，但不会阻止新管理员的首次访问。

### 企业使用 SSO 登录，是否还需要 2FA？

是的，即使您的企业使用 SSO（单点登录）系统，我们仍然建议启用 2FA。这提供了双重保障：

1. SSO 确保用户身份在企业应用间的统一认证
2. 2FA 为企业后台提供额外的安全层级，防止 SSO 凭证被盗用时的未授权访问

这种多层安全策略（又称"深度防御"）是企业信息安全的最佳实践。

### 2FA 是否会影响用户体验和登录效率？

虽然 2FA 确实增加了一个额外的登录步骤，但现代 TOTP 应用使这个过程非常简便快捷，通常只需几秒钟。考虑到它提供的显著安全增益，这种轻微的额外步骤是值得的。
