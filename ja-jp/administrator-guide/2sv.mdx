---
title: 二段階認証
---

## はじめに

企業管理パネルには多くのユーザー機密情報が含まれています。二段階認証は Dify Enterprise Edition システム管理者アカウントに強化されたセキュリティ保護を提供します。有効化すると、元のパスワードが誤って漏洩した場合でも、不正アクセスを防止でき、管理者アカウントと企業システム内のデータのセキュリティを確保できます。

二段階認証は、ユーザーが正しいパスワードを入力した後、認証アプリが生成したリアルタイムの認証コードを入力してログインプロセスを完了することを要求するセキュリティメカニズムです。この「二要素」認証により、アカウントのセキュリティが大幅に向上します。

## 実装の前提条件

二段階認証を設定する前に、以下の要件を満たしていることを確認してください：

1. **システム管理者権限** - システム管理者のみが二段階認証を設定できます。
2. **認証アプリ** - モバイルデバイスに互換性のある認証アプリをインストールする必要があります。

<Info>
認証アプリ（[Google Authenticator](https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2)など）は、TOTP（時間ベースのワンタイムパスワード）標準に基づいており、30秒ごとに新しい認証コードを生成します。
</Info>

## 二段階認証の有効化

チーム全体でグローバルな二段階認証を有効にする前に、まず個人アカウントの二段階認証を設定する必要があります。

### 個人アカウント

個人の二段階認証を設定する手順：

<Steps>
  <Step title="管理パネルにアクセス">
    Dify Enterprise Edition 管理パネルにログインします。
  </Step>
  <Step title="二段階認証設定を開く">
    サイドバーメニューの「二段階認証」オプションをクリックします。
  </Step>
  <Step title="認証アプリを設定">
    認証アプリのセクションを見つけ、右側の「設定」ボタンをクリックします。
  </Step>
  <Step title="QRコードをスキャン">
    認証アプリを使用して表示されたQRコードをスキャンします。
  </Step>
  <Step title="認証コードを入力">
    認証アプリに表示される6桁の認証コードを入力して、設定を完了します。
  </Step>
</Steps>

QRコードをスキャンできない場合は、セットアップキーにカーソルを合わせてキーテキストを表示します。このキーを認証アプリに入力して6桁の認証コードを生成し、認証フィールドにこのコードを入力します。

![](https://assets-docs.dify.ai/2025/04/fd6b474384081f4079aa453c45c07562.png)

二段階認証を有効にすると、バックアップコードが生成されます。認証アプリがインストールされているデバイスを紛失した場合にアカウントにアクセスできなくなることを避けるため、これらのバックアップコードを手動でコピーまたは印刷して、安全な場所に保管することをお勧めします。

![](https://assets-docs.dify.ai/2025/04/2c88c1492bf9a079df9ad4a25e1923ac.png)

バックアップコードは一度しか使用できません。使用すると無効になります。さらにバックアップコードが必要な場合は、「再生成」をクリックしてください。

![](https://assets-docs.dify.ai/2025/04/8313cf497c66cfef7dee2a4ae816c32b.png)

### 企業全体の設定

> すべてのシステム管理者は企業全体の二段階認証を有効にする権限を持っていますが、個人の二段階認証が設定された後でのみグローバル認証を有効にすることができます。

**設定** → **認証** に移動して、企業全体の二段階認証を有効にします。有効にすると、すべてのシステム管理者は企業管理パネルにログインする際に追加の認証コードの提供が必要になります。まだ二段階認証を設定していないシステム管理者がいる場合は、[FAQ](#グローバル強制有効化後まだ個人アカウントの二段階認証を有効にしていない管理者はどうやってログインするのか) を参照してください。

![](https://assets-docs.dify.ai/2025/04/1271b3b0e39558465dbb79b17d1a9721.png)

## 二段階認証の変更

企業管理パネルにアクセスし、「二段階認証」をクリックし、認証アプリの右側のメニューオプションにある「編集」ボタンをクリックします。表示される認証ページで、認証アプリに表示される新しい6桁の認証コードを入力して身元を確認し、変更を完了します。

## 二段階認証の無効化

<Warning>
二段階認証を無効にすると追加のセキュリティレイヤーが削除され、アカウントはパスワード保護のみに依存することになり、不正アクセスのリスクが大幅に増加します。
</Warning>

### 個人アカウント

> 企業が全体的な二段階認証を強制している場合、個人アカウントの二段階認証を無効にすることはできません。

企業管理パネルにアクセスし、「二段階認証」→「二段階認証を無効化」をクリックします。

### 企業全体の設定

企業管理パネルにアクセスし、**「設定」→「認証」**をクリックして、二段階認証のトグルをオフにします。

<Note>
    二段階認証が有効化、変更、または無効化されると、システム管理者はメールで対応する通知を受け取ります。
</Note>

## よくある質問

### 認証アプリがインストールされているデバイスを紛失した場合はどうすればよいですか？

元のデバイスを忘れたり紛失した場合は、以下の方法でログインしてください：

1. **バックアップコードを使用**：ログインページで「バックアップコードを使用」オプションを選択し、以前に保存したバックアップコードの1つを入力します。各バックアップコードは一度しか使用できないことに注意してください。
2. **他のシステム管理者に連絡**：バックアップコードがない場合は、チーム内の他のシステム管理者に連絡して、一時的なアクセスや二段階認証設定のリセットの支援を要請してください。

### 正しい認証コードを入力しても、システムがエラーを表示する場合はどうすればよいですか？

認証コードのエラーは通常、次の理由で発生します：

1. **時間同期の問題**：認証アプリは時間に基づいてコードを生成します。デバイスの時間が標準時間と同期していることを確認してください。ほとんどのスマートフォンは時間を自動的に同期しますが、自動同期をオフにしている場合は、デバイス設定で有効にしてください。
2. **コードの有効期限切れ**：認証コードは通常30秒ごとに更新されます。有効期限が切れそうなタイミングでコードを入力すると、失敗する可能性があります。新しいコードが生成されるのを待ってから、再試行してください。
3. **デバイスとアカウントの不一致**：正しい認証アプリと正しいアカウントを使用して認証コードを生成していることを確認してください。

### 電話を変更した後、認証アプリを移行するにはどうすればよいですか？

認証アプリを移行するには2つの方法があります：

1. **アプリ内移行機能を使用**：一部の認証アプリ（Google Authenticatorの最新バージョンなど）はアカウントのエクスポート/インポート機能を提供しており、この機能を使用して認証情報を新しいデバイスに転送できます。
2. **二段階認証を再設定**：
   - バックアップコードを使用してログインします。
   - [二段階認証の変更](#二段階認証の変更)を参照し、個人の二段階認証設定ページに移動して「編集」をクリックします。
   - 新しいデバイスで生成されたコードを使用して認証を完了します。

### グローバル強制有効化後、まだ個人アカウントの二段階認証を有効にしていない管理者はどうやってログインするのか？

グローバル二段階認証が強制されると、二段階認証をまだ有効にしていない管理者のログインプロセスは次のようになります：

1. 管理者はメールとパスワード（またはSSO）を使用してログインします。
2. システムは管理者が二段階認証を設定していないことを自動的に検出し、企業ログインページで二段階認証のセットアップ手順を提供します。
3. 管理者は認証アプリをダウンロードし、画面の指示に従って二段階認証の設定を完了する必要があります。
4. 設定が完了すると、6桁の認証コードを入力することで管理者は企業管理パネルへのログインを続行できます。
